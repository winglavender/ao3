<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>AO3 History Downloader</title>
    <link rel="stylesheet" type="text/css" href="static/style.css">
    
    <!--Load the AJAX API-->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">

      // Load the Visualization API and the corechart package.
      google.charts.load('current', {'packages':['corechart']});

      // Set a callback to run when the Google Visualization API is loaded.
      google.charts.setOnLoadCallback(drawFandomChart);
      google.charts.setOnLoadCallback(drawRelationshipChart);
      google.charts.setOnLoadCallback(drawFicChart);
      google.charts.setOnLoadCallback(drawAuthorChart);
      google.charts.setOnLoadCallback(drawTagChart);

      // Callback that creates and populates a data table,
      // instantiates the pie chart, passes in the data and
      // draws it.
      function drawFandomChart() {

        // Create the data table.
        var data = new google.visualization.DataTable();
        data.addColumn('string', 'Topping');
        data.addColumn('number', 'Slices');
        data.addRows([
          ['{{data.top_fandoms[0][0]}}', 5],
          ['{{data.top_fandoms[1][0]}}', 4],
          ['{{data.top_fandoms[2][0]}}', 3],
          ['{{data.top_fandoms[3][0]}}', 2],
          ['{{data.top_fandoms[4][0]}}', 1]
        ]);

        // Set chart options
        var options = {'title':'Top Fandoms',
                       'width':600,
                       'height':300};

        // Instantiate and draw our chart, passing in some options.
        var chart = new google.visualization.BarChart(document.getElementById('fandom_chart_div'));
        chart.draw(data, options);
      }
      
      // Callback that creates and populates a data table,
      // instantiates the pie chart, passes in the data and
      // draws it.
      function drawRelationshipChart() {

        // Create the data table.
        var data = new google.visualization.DataTable();
        data.addColumn('string', 'Topping');
        data.addColumn('number', 'Slices');
        data.addRows([
          ['{{data.top_relationships[0][0]}}', 5],
          ['{{data.top_relationships[1][0]}}', 4],
          ['{{data.top_relationships[2][0]}}', 3],
          ['{{data.top_relationships[3][0]}}', 2],
          ['{{data.top_relationships[4][0]}}', 1]
        ]);

        // Set chart options
        var options = {'title':'Top Relationships',
                       'width':600,
                       'height':300};

        // Instantiate and draw our chart, passing in some options.
        var chart = new google.visualization.BarChart(document.getElementById('relationship_chart_div'));
        chart.draw(data, options);
      }
      
      // Callback that creates and populates a data table,
      // instantiates the pie chart, passes in the data and
      // draws it.
      function drawTagChart() {

        // Create the data table.
        var data = new google.visualization.DataTable();
        data.addColumn('string', 'Topping');
        data.addColumn('number', 'Slices');
        data.addRows([
          ['{{data.top_tags[0][0]}}', 5],
          ['{{data.top_tags[1][0]}}', 4],
          ['{{data.top_tags[2][0]}}', 3],
          ['{{data.top_tags[3][0]}}', 2],
          ['{{data.top_tags[4][0]}}', 1]
        ]);

        // Set chart options
        var options = {'title':'Top Tags',
                       'width':600,
                       'height':300};

        // Instantiate and draw our chart, passing in some options.
        var chart = new google.visualization.BarChart(document.getElementById('tag_chart_div'));
        chart.draw(data, options);
      }
      
            // Callback that creates and populates a data table,
      // instantiates the pie chart, passes in the data and
      // draws it.
      function drawAuthorChart() {

        // Create the data table.
        var data = new google.visualization.DataTable();
        data.addColumn('string', 'Topping');
        data.addColumn('number', 'Slices');
        data.addRows([
          ['{{data.top_authors[0][0]}}', 5],
          ['{{data.top_authors[1][0]}}', 4],
          ['{{data.top_authors[2][0]}}', 3],
          ['{{data.top_authors[3][0]}}', 2],
          ['{{data.top_authors[4][0]}}', 1]
        ]);

        // Set chart options
        var options = {'title':'Top Authors',
                       'width':600,
                       'height':300};

        // Instantiate and draw our chart, passing in some options.
        var chart = new google.visualization.BarChart(document.getElementById('author_chart_div'));
        chart.draw(data, options);
      }
      
                  // Callback that creates and populates a data table,
      // instantiates the pie chart, passes in the data and
      // draws it.
      function drawFicChart() {

        // Create the data table.
        var data = new google.visualization.DataTable();
        data.addColumn('string', 'Topping');
        data.addColumn('number', 'Slices');
        data.addRows([
          ['{{data.top_fics[0][0]}}', 5],
          ['{{data.top_fics[1][0]}}', 4],
          ['{{data.top_fics[2][0]}}', 3],
          ['{{data.top_fics[3][0]}}', 2],
          ['{{data.top_fics[4][0]}}', 1]
        ]);

        // Set chart options
        var options = {'title':'Top Fics',
                       'width':600,
                       'height':300};

        // Instantiate and draw our chart, passing in some options.
        var chart = new google.visualization.BarChart(document.getElementById('fic_chart_div'));
        chart.draw(data, options);
      }
    </script>
  </head>
  <body>

    <h1>
      AO3 {{data.year}} Reading Year in Review 
    </h1>

    <table>
      <tr>
        <th>Overall Reading Stats</th>
      </tr>
      <tr>
        <td>Words</td>
        <td>{{data.total_words}}</td>
      </tr>
      <tr>
        <td>Works</td>
        <td>{{data.total_fics}}</td>
      </tr>
      <tr>
        <td>Relationships</td>
        <td>{{data.total_relationships}}</td>
      </tr>
      <tr>
        <td>Fandoms</td>
        <td>{{data.total_fandoms}}</td>
      </tr>
    </table>
    

    <table>
      <tr>
        <td><div id="fandom_chart_div"></div></td>
      </tr>
      <tr>
        <td><div id="tag_chart_div"></div></td>
      </tr>
      <tr>
        <td><div id="relationship_chart_div"></div></td>
      </tr>
      <tr>
        <td><div id="fic_chart_div"></div></td>
      </tr>
      <tr>
        <td><div id="author_chart_div"></div></td>
      </tr>
    </table>
    
    <p>
    You can also download a spreadsheet containing all your data from this year.
    </p>
    
    <p>
      <a href="/download">Download File</a>
    </p>
    
    <p>
      <a href="{{ url_for('home') }}">Return to main page</a>
    </p>
  </body>
</html>
